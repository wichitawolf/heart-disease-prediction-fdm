{% extends 'index.html' %}
{% load static %}
{% block body %}
<!-- Main Content -->
<main class="main-content">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Hero Section -->
                <div class="hero-section text-center mb-4">
                    <h1 class="hero-title">
                        <i class="fas fa-chart-line text-primary me-3"></i>
                        Heart Disease Prediction Results
                    </h1>
                    <p class="hero-subtitle">
                        <c>Your AI-powered heart health assessment is ready</c>
                    </p>
                </div>

                <!-- Main Results Card -->
                <div class="card-modern">
                    <div class="card-header text-center">
                        <h2 class="card-title">
                            <i class="fas fa-heartbeat me-2"></i>Prediction Results
                        </h2>
                        <p class="card-subtitle">Your heart disease risk assessment</p>
                    </div>
                    <div class="card-body">
                        <!-- Prediction Result -->
                        <div class="prediction-section mb-5">
                            <div class="prediction-result-card">
                                <div class="result-header text-center mb-4">
                                    <h3 class="result-title">
                                        <i class="fas fa-brain me-2"></i>AI Prediction Result
                                    </h3>
                                </div>
                                
                                <div class="result-content">
                                    <div class="result-display text-center mb-4">
                                    {{ prediction|safe }}
                                </div>
                                    
                                    <div class="risk-indicator text-center mb-4">
                                    {% with pred_text=prediction|lower %}
                                            {% if "unhealthy" in pred_text or "high" in pred_text %}
                                                <div class="risk-badge high-risk">
                                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                                    <span>High Risk - Consult Doctor</span>
                                                </div>
                                        {% else %}
                                                <div class="risk-badge low-risk">
                                                    <i class="fas fa-check-circle me-2"></i>
                                                    <span>Low Risk - Keep Healthy</span>
                                                </div>
                                        {% endif %}
                                    {% endwith %}
                                </div>
                                    
                                    <div class="accuracy-display text-center">
                                        <div class="accuracy-card">
                                            <i class="fas fa-chart-line me-2"></i>
                                            <span class="accuracy-label">Model Confidence:</span>
                                            <span class="accuracy-value">{{ accuracy|floatformat:1 }}%</span>
                                </div>
                            </div>
                        </div>
                            </div>
                        </div>
                        <!-- Confidence Bar Section -->
                        <div class="confidence-section mb-4">
                            <div class="confidence-card">
                                <div class="confidence-header text-center mb-3">
                                    <h4 class="confidence-title">
                                        <i class="fas fa-chart-line me-2"></i>Prediction Confidence
                                    </h4>
                                    <p class="confidence-subtitle">Model confidence level: {{ accuracy|default:0 }}%</p>
                                </div>
                                
                                <!-- Progress Bar Container -->
                                <div class="progress-container">
                                    <div class="progress-bar-wrapper">
                                        <div class="progress-bar-bg">
                                            <div class="progress-bar-fill" style="width: {{ accuracy|default:0 }}%;">
                                                <span class="progress-percentage">{{ accuracy|default:0 }}%</span>
                                            </div>
                                        </div>
                                        <div class="progress-scale">
                                            <span>0%</span>
                                            <span>25%</span>
                                            <span>50%</span>
                                            <span>75%</span>
                                            <span>100%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Chart.js Canvas (Hidden by default, shown if JS works) -->
                                <div class="chart-container" style="position: relative; height: 200px; width: 100%; display: none;">
                                    <canvas id="guestProbabilityChart" aria-label="Prediction probability chart" role="img"></canvas>
                                </div>
                                
                                <!-- Fallback Chart (Hidden by default) -->
                                <div id="fallbackChart" style="display: none; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-top: 15px;">
                                    <h6>Alternative Chart View</h6>
                                    <p style="margin: 0; font-size: 12px; color: #6c757d;">Interactive chart will appear here if JavaScript is enabled.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Health Recommendations -->
                        <div class="recommendations-section mb-5">
                            <div class="recommendations-card">
                                <div class="recommendations-header">
                                    <h4 class="recommendations-title">
                                        <i class="fas fa-lightbulb me-2"></i>Health Recommendations
                                    </h4>
                                    <p class="recommendations-subtitle">Personalized advice based on your results</p>
                                </div>
                                
                                {% if "healthy" in prediction|lower %}
                                    <!-- Healthy Recommendations -->
                                    <div class="recommendation-item success-recommendation">
                                        <div class="recommendation-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="recommendation-content">
                                            <h5 class="recommendation-title">🎉 Excellent! You're Maintaining Good Heart Health</h5>
                                            <p class="recommendation-description">Your current lifestyle choices are supporting your cardiovascular health. Keep up the great work!</p>
                                            
                                            <div class="recommendation-categories">
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-heart me-2"></i>Lifestyle Maintenance</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-running me-2"></i>
                                                            <span>Continue 30+ minutes of daily exercise</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-apple-alt me-2"></i>
                                                            <span>Maintain balanced diet with fruits and vegetables</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-bed me-2"></i>
                                                            <span>Get 7-8 hours of quality sleep nightly</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-ban me-2"></i>
                                                            <span>Avoid smoking and limit alcohol consumption</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-chart-line me-2"></i>Health Monitoring</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-calendar-check me-2"></i>
                                                            <span>Annual comprehensive health checkup</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-heartbeat me-2"></i>
                                                            <span>Monitor blood pressure every 6 months</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-vial me-2"></i>
                                                            <span>Cholesterol test annually</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-weight me-2"></i>
                                                            <span>Maintain healthy weight (BMI 18.5-24.9)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-shield-alt me-2"></i>Prevention Focus</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-om me-2"></i>
                                                            <span>Practice stress management techniques</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-users me-2"></i>
                                                            <span>Stay socially connected and engaged</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-tooth me-2"></i>
                                                            <span>Maintain good oral hygiene (affects heart health)</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-sun me-2"></i>
                                                            <span>Get adequate vitamin D through sunlight or supplements</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% else %}
                                    <!-- Unhealthy Recommendations -->
                                    <div class="recommendation-item warning-recommendation">
                                        <div class="recommendation-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="recommendation-content">
                                            <h5 class="recommendation-title">⚠️ Action Required: Prioritize Your Heart Health</h5>
                                            <p class="recommendation-description">Your results indicate potential heart health concerns. Immediate action and lifestyle changes are recommended.</p>
                                            
                                            <div class="recommendation-categories">
                                                <div class="category-section urgent">
                                                    <h6 class="category-title"><i class="fas fa-user-md me-2"></i>Immediate Medical Actions</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point urgent">
                                                            <i class="fas fa-phone me-2"></i>
                                                            <span>Schedule cardiologist appointment within 1 week</span>
                                                        </div>
                                                        <div class="recommendation-point urgent">
                                                            <i class="fas fa-stethoscope me-2"></i>
                                                            <span>Get comprehensive heart health evaluation</span>
                                                        </div>
                                                        <div class="recommendation-point urgent">
                                                            <i class="fas fa-pills me-2"></i>
                                                            <span>Discuss medication options with your doctor</span>
                                                        </div>
                                                        <div class="recommendation-point urgent">
                                                            <i class="fas fa-ambulance me-2"></i>
                                                            <span>Know emergency signs: chest pain, shortness of breath</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-heart me-2"></i>Lifestyle Changes</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-utensils me-2"></i>
                                                            <span>Start heart-healthy diet (DASH or Mediterranean)</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-running me-2"></i>
                                                            <span>Begin light exercise (10-15 min daily, increase gradually)</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-ban me-2"></i>
                                                            <span>Quit smoking immediately if applicable</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-wine-glass-alt me-2"></i>
                                                            <span>Limit alcohol to 1 drink/day (women) or 2 drinks/day (men)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-chart-line me-2"></i>Monitoring & Tracking</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-heartbeat me-2"></i>
                                                            <span>Monitor blood pressure daily</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-weight me-2"></i>
                                                            <span>Track weight weekly, aim for 5-10% weight loss</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-calendar-alt me-2"></i>
                                                            <span>Follow-up appointments every 3-6 months</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-clipboard-list me-2"></i>
                                                            <span>Keep a health journal of symptoms and medications</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="category-section">
                                                    <h6 class="category-title"><i class="fas fa-shield-alt me-2"></i>Risk Reduction</h6>
                                                    <div class="recommendation-list">
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-om me-2"></i>
                                                            <span>Practice stress reduction (meditation, yoga)</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-bed me-2"></i>
                                                            <span>Improve sleep quality and duration</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-seedling me-2"></i>
                                                            <span>Increase fiber intake (25-35g daily)</span>
                                                        </div>
                                                        <div class="recommendation-point">
                                                            <i class="fas fa-fish me-2"></i>
                                                            <span>Include omega-3 fatty acids (fish, flaxseed)</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <!-- Download Health Report Section -->
                        <div class="download-section mb-5">
                            <div class="download-card">
                                <div class="download-header">
                                    <h4 class="download-title">
                                        <i class="fas fa-download me-2"></i>Download Your Health Report
                                    </h4>
                                    <p class="download-subtitle">Get a personalized health report with detailed recommendations</p>
                                </div>
                                
                <div class="download-options">
                    <div class="download-option">
                        <div class="download-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="download-content">
                            <h6 class="download-option-title">PDF Health Report</h6>
                            <p class="download-option-desc">Complete health assessment with personalized recommendations</p>
                            <a href="/download/pdf/?prediction={{ prediction|urlencode }}&accuracy={{ accuracy }}" class="download-btn pdf-btn" target="_blank">
                                <i class="fas fa-download me-2"></i>Download PDF
                            </a>
                        </div>
                    </div>
                                    
                                    <div class="download-option">
                                        <div class="download-icon">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="download-content">
                                            <h6 class="download-option-title">Text Summary</h6>
                                            <p class="download-option-desc">Simple text format for easy sharing with your doctor</p>
                                            <a href="/download/txt/?prediction={{ prediction|urlencode }}&accuracy={{ accuracy }}" class="download-btn text-btn" target="_blank">
                                                <i class="fas fa-download me-2"></i>Download Text
                                            </a>
                                        </div>
                                    </div>
                                    
                                    <div class="download-option">
                                        <div class="download-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                        <div class="download-content">
                                            <h6 class="download-option-title">Health Dashboard</h6>
                                            <p class="download-option-desc">Visual health metrics and progress tracking guide</p>
                                            <a href="/download/dashboard/?prediction={{ prediction|urlencode }}&accuracy={{ accuracy }}" class="download-btn dashboard-btn" target="_blank">
                                                <i class="fas fa-download me-2"></i>Download Dashboard
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="download-features">
                                    <h6 class="features-title">What's Included in Your Report:</h6>
                                    <div class="features-grid">
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Detailed risk assessment</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Personalized recommendations</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Lifestyle modification tips</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Medical consultation guidance</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Follow-up schedule suggestions</span>
                                        </div>
                                        <div class="feature-item">
                                            <i class="fas fa-check-circle text-success me-2"></i>
                                            <span>Emergency contact information</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons-section">
                            <div class="action-buttons-container">
                                <a href="{% url 'add_heartdetail' %}" class="action-btn primary-btn">
                                    <i class="fas fa-redo me-2"></i>
                                    <span>New Prediction</span>
                                </a>
                                <a href="{% url 'add_heartdetail' %}" class="action-btn success-btn">
                                    <i class="fas fa-undo me-2"></i>
                                    <span>Try Again</span>
                                </a>
                                <a href="{% url 'home' %}" class="action-btn secondary-btn">
                                    <i class="fas fa-home me-2"></i>
                                    <span>Back to Home</span>
                            </a>
                        </div>
                        </div>
                        
                        <!-- Disclaimer -->
                        <div class="disclaimer-section">
                            <div class="disclaimer-card">
                                <div class="disclaimer-icon">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="disclaimer-content">
                                    <h6 class="disclaimer-title">Important Medical Disclaimer</h6>
                                    <p class="disclaimer-text">
                                        This prediction is based on machine learning algorithms and should not replace professional medical advice. 
                                        Always consult with qualified healthcare professionals for medical decisions and treatment.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<style>
/* Hero Section */
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 3rem 2rem;
    border-radius: 20px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.hero-subtitle {
    font-size: 1.2rem;
    opacity: 0.9;
    margin: 0;
}

/* Card Enhancements */
.card-modern {
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    border: none;
    overflow: hidden;
    background: white;
}

.card-header {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    color: white;
    border: none;
    padding: 2rem;
}

.card-title {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
}

.card-subtitle {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

/* Prediction Result Card */
.prediction-result-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #dee2e6;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.prediction-result-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.result-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.result-display {
    font-size: 1.8rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 1.5rem;
}

/* Risk Badges */
.risk-badge {
    display: inline-flex;
    align-items: center;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

.risk-badge:hover {
    transform: scale(1.05);
}

.high-risk {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
}

.low-risk {
    background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
    color: white;
}

/* Accuracy Display */
.accuracy-card {
    background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 15px;
    display: inline-flex;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.accuracy-label {
    margin-right: 0.5rem;
    font-weight: 500;
}

.accuracy-value {
    font-weight: 700;
    font-size: 1.2rem;
}

/* Chart Section */
.chart-card {
    background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    border: 1px solid #bbdefb;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.chart-header {
    text-align: center;
    margin-bottom: 1.5rem;
}

.chart-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.chart-subtitle {
    color: #666;
    margin: 0;
}

.chart-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
}

/* Recommendations Section */
.recommendations-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 2rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.recommendations-header {
    text-align: center;
    margin-bottom: 2rem;
}

.recommendations-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.recommendations-subtitle {
    color: #666;
    margin: 0;
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    padding: 1.5rem;
    border-radius: 15px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
}

.recommendation-item:hover {
    transform: translateX(10px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.success-recommendation {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    border-left: 5px solid #28a745;
}

.warning-recommendation {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-left: 5px solid #ffc107;
}

.recommendation-icon {
    font-size: 2rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.success-recommendation .recommendation-icon {
    color: #28a745;
}

.warning-recommendation .recommendation-icon {
    color: #ffc107;
}

.recommendation-content {
    flex: 1;
}

.recommendation-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 1rem;
}

.recommendation-list {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.recommendation-point {
    display: flex;
    align-items: center;
    color: #555;
    font-size: 0.95rem;
}

.recommendation-point i {
    color: #1976d2;
    width: 20px;
    flex-shrink: 0;
}

/* Action Buttons */
.action-buttons-section {
    margin: 3rem 0;
}

.action-buttons-container {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    padding: 1rem 2rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border: none;
    cursor: pointer;
}

.action-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    text-decoration: none;
}

.primary-btn {
    background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
    color: white;
}

.success-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.secondary-btn {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: white;
}

/* Download Section */
.download-section {
    margin: 3rem 0;
}

.download-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.download-header {
    text-align: center;
    margin-bottom: 2rem;
}

.download-title {
    color: #1976d2;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.download-subtitle {
    color: #666;
    margin: 0;
    font-size: 1.1rem;
}

.download-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.download-option {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 15px;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.download-option:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    border-color: #1976d2;
}

.download-icon {
    font-size: 2.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
    color: #1976d2;
}

.download-content {
    flex: 1;
}

.download-option-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.download-option-desc {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    line-height: 1.4;
}

.download-btn {
    display: inline-flex;
    align-items: center;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

.pdf-btn {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
}

.text-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
}

.dashboard-btn {
    background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
    color: white;
}

.download-features {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    border: 1px solid #e9ecef;
}

.features-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 1rem;
    text-align: center;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.8rem;
}

.feature-item {
    display: flex;
    align-items: center;
    color: #555;
    font-size: 0.9rem;
    padding: 0.5rem 0;
}

.feature-item i {
    font-size: 1rem;
}

/* Disclaimer Section */
.disclaimer-section {
    margin-top: 2rem;
}

.disclaimer-card {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 1px solid #ffc107;
    border-radius: 15px;
    padding: 1.5rem;
    display: flex;
    align-items: flex-start;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.disclaimer-icon {
    color: #ffc107;
    font-size: 1.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.disclaimer-content {
    flex: 1;
}

.disclaimer-title {
    color: #856404;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.disclaimer-text {
    color: #856404;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.5;
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.prediction-result-card,
.chart-card,
.recommendations-card,
.disclaimer-card {
    animation: fadeInUp 0.6s ease-out;
}

/* Responsive Design */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1rem;
    }
    
    .action-buttons-container {
        flex-direction: column;
        align-items: center;
    }
    
    .action-btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
    }
    
    .recommendation-item {
        flex-direction: column;
        text-align: center;
    }
    
    .recommendation-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .disclaimer-card {
        flex-direction: column;
        text-align: center;
    }
    
    .disclaimer-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .download-options {
        grid-template-columns: 1fr;
    }
    
    .download-option {
        flex-direction: column;
        text-align: center;
    }
    
    .download-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 576px) {
    .hero-section {
        padding: 2rem 1rem;
    }
    
    .card-header {
        padding: 1.5rem;
    }
    
    .prediction-result-card,
    .chart-card,
    .recommendations-card {
        padding: 1.5rem;
    }
}

/* Confidence Bar Styles */
.confidence-section {
    margin-bottom: 2rem;
}

.confidence-card {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.confidence-header {
    margin-bottom: 1.5rem;
}

.confidence-title {
    color: #2c3e50;
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.confidence-subtitle {
    color: #6c757d;
    font-size: 1rem;
    margin: 0;
    font-weight: 500;
}

.progress-container {
    margin: 1rem 0;
}

.progress-bar-wrapper {
    position: relative;
}

.progress-bar-bg {
    width: 100%;
    height: 50px;
    background: #e9ecef;
    border-radius: 25px;
    position: relative;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    border: 2px solid #dee2e6;
}

.progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #5A9BC3 0%, #4a90e2 50%, #3d7bd6 100%);
    border-radius: 25px;
    position: relative;
    transition: width 1.5s ease-in-out;
    box-shadow: 0 2px 8px rgba(90, 155, 195, 0.3);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 15px;
}

.progress-percentage {
    color: white;
    font-weight: bold;
    font-size: 16px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    z-index: 2;
}

.progress-scale {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 12px;
    color: #6c757d;
    font-weight: 500;
    padding: 0 5px;
}

.progress-scale span {
    position: relative;
}

.progress-scale span::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 6px;
    background: #dee2e6;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .confidence-card {
        padding: 1rem;
    }
    
    .confidence-title {
        font-size: 1.2rem;
    }
    
    .progress-bar-bg {
        height: 40px;
    }
    
    .progress-percentage {
        font-size: 14px;
    }
    
    .progress-scale {
        font-size: 11px;
    }
}

/* Enhanced Recommendation Styles */
.recommendation-categories {
    margin-top: 1.5rem;
}

.category-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 12px;
    border-left: 4px solid #5A9BC3;
}

.category-section.urgent {
    background: #fff3cd;
    border-left-color: #ffc107;
    border: 1px solid #ffeaa7;
}

.category-title {
    color: #2c3e50;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
}

.category-section.urgent .category-title {
    color: #856404;
}

.recommendation-description {
    color: #6c757d;
    font-size: 1rem;
    margin-bottom: 1.5rem;
    line-height: 1.6;
    font-style: italic;
}

.recommendation-list {
    display: grid;
    gap: 0.75rem;
}

.recommendation-point {
    display: flex;
    align-items: flex-start;
    padding: 0.75rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
}

.recommendation-point:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: #5A9BC3;
}

.recommendation-point.urgent {
    background: #fff8e1;
    border-color: #ffc107;
}

.recommendation-point.urgent:hover {
    border-color: #ff9800;
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
}

.recommendation-point i {
    color: #5A9BC3;
    margin-top: 0.2rem;
    flex-shrink: 0;
}

.recommendation-point.urgent i {
    color: #ff9800;
}

.recommendation-point span {
    color: #2c3e50;
    font-weight: 500;
    line-height: 1.5;
    margin-left: 0.75rem;
}

.recommendation-point.urgent span {
    color: #856404;
    font-weight: 600;
}

/* Responsive adjustments for recommendations */
@media (max-width: 768px) {
    .category-section {
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .category-title {
        font-size: 1rem;
    }
    
    .recommendation-point {
        padding: 0.5rem;
    }
    
    .recommendation-point span {
        font-size: 0.9rem;
    }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
// Debug Chart.js loading
window.addEventListener('load', function() {
    console.log('Page loaded, Chart.js available:', typeof Chart !== 'undefined');
    if (typeof Chart === 'undefined') {
        console.error('Chart.js failed to load!');
    }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Chart initialization started');
    var ctx = document.getElementById('guestProbabilityChart');
    console.log('Canvas element:', ctx);
    console.log('Chart.js available:', typeof Chart !== 'undefined');
    
    // Set timeout to show fallback if Chart.js doesn't load
    var chartTimeout = setTimeout(function() {
        if (typeof Chart === 'undefined') {
            console.log('Chart.js timeout - showing fallback');
            var fallbackChart = document.getElementById('fallbackChart');
            if (fallbackChart) {
                fallbackChart.style.display = 'block';
            }
        }
    }, 3000);
    
    if (ctx && typeof Chart !== 'undefined') {
        var acc = Number('{{ accuracy|default:0 }}');
        console.log('Accuracy value:', acc);
        
        var data = [
            Math.max(0, Math.min(100, acc)), 
            Math.max(0, 100 - Math.max(0, Math.min(100, acc)))
        ];
        console.log('Chart data:', data);
        
        try {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Predicted Confidence', 'Remaining'],
                    datasets: [{
                        data: data,
                        backgroundColor: ['#5A9BC3', '#E8F2F7'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
            console.log('Chart created successfully');
            clearTimeout(chartTimeout); // Clear timeout since chart was created successfully
            
            // Show the chart container
            var chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.style.display = 'block';
            }
        } catch (error) {
            console.error('Error creating chart:', error);
            // Show fallback on error
            var fallbackChart = document.getElementById('fallbackChart');
            if (fallbackChart) {
                fallbackChart.style.display = 'block';
            }
        }
    } else {
        console.error('Chart.js not loaded or canvas not found');
        // Show fallback chart
        var fallbackChart = document.getElementById('fallbackChart');
        if (fallbackChart) {
            fallbackChart.style.display = 'block';
            console.log('Showing fallback chart');
        }
    }
});


// Alternative Download Function (simpler method)
function alternativeDownload(content, filename, mimeType) {
    console.log('Using alternative download method');
    
    try {
        // Method 1: Direct blob download
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        URL.revokeObjectURL(url);
        
        return true;
    } catch (error) {
        console.error('Alternative download failed:', error);
        
        // Method 2: Open in new window
        try {
            const newWindow = window.open('', '_blank');
            if (newWindow) {
                newWindow.document.write(content);
                newWindow.document.close();
                newWindow.document.title = filename;
                return true;
            }
        } catch (windowError) {
            console.error('Window method failed:', windowError);
        }
        
        return false;
    }
}

// Simple Download Health Report Function
function downloadHealthReport(format) {
    console.log('Download function called with format:', format);
    
    try {
        const prediction = '{{ prediction|safe }}';
        const accuracy = '{{ accuracy|default:0 }}';
        const isHealthy = prediction.includes('healthy') || prediction.includes('Healthy');
        const currentDate = new Date().toLocaleDateString();
        const currentTime = new Date().toLocaleTimeString();
        
        console.log('Prediction:', prediction);
        console.log('Accuracy:', accuracy);
        console.log('Is Healthy:', isHealthy);
        
        let content = '';
        let filename = '';
        let mimeType = '';
        
        if (format === 'pdf') {
            content = generateSimplePDFContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Heart_Health_Report_${currentDate.replace(/\//g, '-')}.html`;
            mimeType = 'text/html';
        } else if (format === 'txt') {
            content = generateSimpleTextContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Heart_Health_Summary_${currentDate.replace(/\//g, '-')}.txt`;
            mimeType = 'text/plain';
        } else if (format === 'dashboard') {
            content = generateSimpleDashboardContent(prediction, accuracy, isHealthy, currentDate, currentTime);
            filename = `Health_Dashboard_${currentDate.replace(/\//g, '-')}.html`;
            mimeType = 'text/html';
        }
        
        console.log('Content length:', content.length);
        console.log('Filename:', filename);
        
        // Simple download method
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        console.log('Download completed successfully');
        alert('Download completed! Check your downloads folder.');
        
    } catch (error) {
        console.error('Error in download function:', error);
        alert('Error generating download: ' + error.message);
    }
}

// Simple Content Generation Functions
function generateSimplePDFContent(prediction, accuracy, isHealthy, date, time) {
    return `<!DOCTYPE html>
<html>
<head>
    <title>Heart Health Report - ${date}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #1976d2; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; }
        .result { background: ${isHealthy ? '#d4edda' : '#f8d7da'}; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .section { margin: 20px 0; }
        h2 { color: #1976d2; }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏥 Heart Health Report</h1>
        <p>Generated on ${date} at ${time}</p>
    </div>
    <div class="content">
        <div class="result">
            <h2>Prediction Result</h2>
            <p><strong>${prediction.replace(/<[^>]*>/g, '')}</strong></p>
            <p>Confidence: ${accuracy}%</p>
        </div>
        <div class="section">
            <h2>Recommendations</h2>
            <p>${isHealthy ? 'Continue maintaining your healthy lifestyle with regular exercise and balanced diet.' : 'Please consult with a healthcare professional immediately for proper evaluation and treatment.'}</p>
        </div>
        <div class="section">
            <h2>Important Notice</h2>
            <p>This report is generated by an AI system and should not replace professional medical advice. Always consult with qualified healthcare professionals.</p>
        </div>
    </div>
</body>
</html>`;
}

function generateSimpleTextContent(prediction, accuracy, isHealthy, date, time) {
    return `HEART HEALTH SUMMARY
===================

Date: ${date}
Time: ${time}
Confidence: ${accuracy}%

PREDICTION RESULT:
${prediction.replace(/<[^>]*>/g, '')}

RECOMMENDATIONS:
${isHealthy ? 'Continue maintaining your healthy lifestyle with regular exercise and balanced diet.' : 'Please consult with a healthcare professional immediately for proper evaluation and treatment.'}

IMPORTANT NOTICE:
This report is generated by an AI system and should not replace professional medical advice. Always consult with qualified healthcare professionals.

Generated by Heart Disease Prediction System
${date}`;
}

function generateSimpleDashboardContent(prediction, accuracy, isHealthy, date, time) {
    return `<!DOCTYPE html>
<html>
<head>
    <title>Health Dashboard - ${date}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .header { background: #6f42c1; color: white; padding: 20px; text-align: center; border-radius: 10px; }
        .metric { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #6f42c1; }
        .status { background: ${isHealthy ? '#d4edda' : '#f8d7da'}; padding: 15px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📈 Health Dashboard</h1>
            <p>Generated on ${date} at ${time}</p>
        </div>
        <div class="status">
            <h2>Current Status</h2>
            <p><strong>${prediction.replace(/<[^>]*>/g, '')}</strong></p>
            <p>Confidence: ${accuracy}%</p>
        </div>
        <div class="metric">
            <h3>Health Metrics</h3>
            <p>Target Blood Pressure: <120/80 mmHg</p>
            <p>Target Cholesterol: <200 mg/dL</p>
            <p>Target Exercise: 150 min/week</p>
        </div>
        <div class="metric">
            <h3>Goals</h3>
            <p>${isHealthy ? 'Maintain current healthy lifestyle' : 'Improve cardiovascular health through lifestyle changes'}</p>
        </div>
        <div class="metric">
            <h3>Next Steps</h3>
            <p>${isHealthy ? 'Continue regular health monitoring' : 'Schedule consultation with healthcare provider'}</p>
        </div>
    </div>
</body>
</html>`;
}

function generateAttractivePDFContent(prediction, accuracy, isHealthy, date, time) {
    return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Health Report - ${date}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%); 
            color: white; 
            padding: 40px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content { padding: 40px; }
        .section { margin-bottom: 30px; }
        .section h2 { 
            color: #1976d2; 
            font-size: 1.8em; 
            margin-bottom: 15px; 
            padding-bottom: 10px; 
            border-bottom: 3px solid #1976d2; 
        }
        .prediction-result { 
            background: ${isHealthy ? 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)' : 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)'}; 
            padding: 20px; 
            border-radius: 15px; 
            border-left: 5px solid ${isHealthy ? '#28a745' : '#dc3545'}; 
            margin: 20px 0; 
        }
        .prediction-result h3 { 
            color: ${isHealthy ? '#155724' : '#721c24'}; 
            font-size: 1.5em; 
            margin-bottom: 10px; 
        }
        .confidence { 
            background: linear-gradient(135deg, #74c0fc 0%, #339af0 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            text-align: center; 
            font-size: 1.2em; 
            font-weight: 600; 
            margin: 20px 0; 
        }
        .recommendations { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid #dee2e6; 
        }
        .recommendations ul { list-style: none; padding: 0; }
        .recommendations li { 
            padding: 8px 0; 
            border-bottom: 1px solid #e9ecef; 
            display: flex; 
            align-items: center; 
        }
        .recommendations li:last-child { border-bottom: none; }
        .recommendations li::before { 
            content: '${isHealthy ? '✓' : '⚠️'}'; 
            color: ${isHealthy ? '#28a745' : '#ffc107'}; 
            font-weight: bold; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .emergency { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
            border: 2px solid #ffc107; 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
        }
        .emergency h3 { color: #856404; margin-bottom: 15px; }
        .highlight { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            padding: 15px; 
            border-radius: 10px; 
            margin: 15px 0; 
            border-left: 4px solid #1976d2; 
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            border: 1px solid #e9ecef; 
        }
        .card h4 { color: #1976d2; margin-bottom: 10px; }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏥 Heart Health Report</h1>
            <p>Generated on ${date} at ${time}</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>📊 Prediction Results</h2>
                <div class="prediction-result">
                    <h3>${prediction.replace(/<[^>]*>/g, '')}</h3>
                </div>
                <div class="confidence">
                    Model Confidence: ${accuracy}%
                </div>
            </div>

            <div class="section">
                <h2>${isHealthy ? '💚 Healthy Lifestyle Recommendations' : '🚨 Urgent Health Actions Required'}</h2>
                <div class="recommendations">
                    <ul>
                        ${isHealthy ? getHealthyRecommendationsHTML() : getUnhealthyRecommendationsHTML()}
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>📋 Detailed Health Guidance</h2>
                <div class="highlight">
                    ${isHealthy ? getHealthyDetailedGuidanceHTML() : getUnhealthyDetailedGuidanceHTML()}
                </div>
            </div>

            <div class="section">
                <h2>📞 Emergency Contacts</h2>
                <div class="emergency">
                    <h3>🚨 Emergency Services</h3>
                    <p><strong>US:</strong> 911 | <strong>UK:</strong> 999 | <strong>EU:</strong> 112</p>
                    <p><strong>National Heart Helpline:</strong> 1-800-HEART-1</p>
                    <p><strong>Your Local Hospital:</strong> Contact your nearest hospital</p>
                </div>
            </div>

            <div class="section">
                <h2>📅 Follow-up Schedule</h2>
                <div class="grid">
                    <div class="card">
                        <h4>Immediate Actions</h4>
                        <p>${isHealthy ? 'Continue current healthy lifestyle' : 'Schedule cardiologist appointment within 1 week'}</p>
                    </div>
                    <div class="card">
                        <h4>Short-term (1-3 months)</h4>
                        <p>${isHealthy ? 'Annual physical examination' : 'Follow-up every 3-6 months'}</p>
                    </div>
                    <div class="card">
                        <h4>Long-term (6-12 months)</h4>
                        <p>${isHealthy ? 'Continue monitoring and healthy habits' : 'Regular medication review and lifestyle adjustments'}</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
    `.trim();
}

function generateAttractiveTextContent(prediction, accuracy, isHealthy, date, time) {
    return `
╔══════════════════════════════════════════════════════════════════════════════╗
║                           🏥 HEART HEALTH SUMMARY 🏥                        ║
╚══════════════════════════════════════════════════════════════════════════════╝

📅 Date: ${date}
🕐 Time: ${time}
📊 Confidence: ${accuracy}%

${'='.repeat(80)}

🎯 PREDICTION RESULT:
${prediction.replace(/<[^>]*>/g, '')}

${'='.repeat(80)}

${isHealthy ? '💚 KEEP UP THE GOOD WORK! 💚' : '🚨 ACTION REQUIRED - CONSULT YOUR DOCTOR 🚨'}

${'='.repeat(80)}

📋 RECOMMENDATIONS:
${isHealthy ? getHealthyRecommendations() : getUnhealthyRecommendations()}

${'='.repeat(80)}

📅 NEXT STEPS:
${isHealthy ? getHealthyFollowUp() : getUnhealthyFollowUp()}

${'='.repeat(80)}

🚨 EMERGENCY CONTACTS:
• Emergency Services: 911 (US) / 999 (UK) / 112 (EU)
• National Heart Helpline: 1-800-HEART-1
• Your Local Hospital: Contact your nearest hospital

${'='.repeat(80)}

⚠️  IMPORTANT DISCLAIMER:
This report is generated by an AI system and should not replace 
professional medical advice. Always consult with qualified healthcare 
professionals for medical decisions and treatment.

Generated by Heart Disease Prediction System
For more information, visit: http://127.0.0.1:8000

${'='.repeat(80)}
    `.trim();
}

function generateAttractiveDashboardContent(prediction, accuracy, isHealthy, date, time) {
    return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard - ${date}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }
        .status-card { 
            background: ${isHealthy ? 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)' : 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)'}; 
            padding: 25px; 
            border-radius: 15px; 
            border-left: 5px solid ${isHealthy ? '#28a745' : '#dc3545'}; 
            margin: 20px 0; 
            text-align: center;
        }
        .status-card h2 { 
            color: ${isHealthy ? '#155724' : '#721c24'}; 
            font-size: 1.8em; 
            margin-bottom: 10px; 
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 30px 0; 
        }
        .metric-card { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            border: 1px solid #e9ecef; 
        }
        .metric-card h3 { 
            color: #6f42c1; 
            margin-bottom: 15px; 
            font-size: 1.3em; 
            display: flex; 
            align-items: center; 
        }
        .metric-card h3::before { 
            content: '📊'; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .checklist { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 15px; 
            border: 1px solid #dee2e6; 
            margin: 20px 0; 
        }
        .checklist h3 { 
            color: #6f42c1; 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
        }
        .checklist h3::before { 
            content: '✅'; 
            margin-right: 10px; 
        }
        .checklist-item { 
            padding: 8px 0; 
            border-bottom: 1px solid #e9ecef; 
            display: flex; 
            align-items: center; 
        }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-item::before { 
            content: '☐'; 
            color: #6f42c1; 
            font-weight: bold; 
            margin-right: 10px; 
            font-size: 1.2em; 
        }
        .progress-bar { 
            background: #e9ecef; 
            border-radius: 10px; 
            height: 20px; 
            margin: 10px 0; 
            overflow: hidden; 
        }
        .progress-fill { 
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
            height: 100%; 
            border-radius: 10px; 
            transition: width 0.3s ease; 
        }
        .highlight { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
            border-left: 5px solid #6f42c1; 
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📈 Health Dashboard</h1>
            <p>Generated on ${date} at ${time} | Confidence: ${accuracy}%</p>
        </div>
        
        <div class="content">
            <div class="status-card">
                <h2>${prediction.replace(/<[^>]*>/g, '')}</h2>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <h3>Health Metrics</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyMetricsHTML() : getUnhealthyMetricsHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Goal Setting</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyGoalsHTML() : getUnhealthyGoalsHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Progress Tracking</h3>
                    <div class="highlight">
                        ${isHealthy ? getHealthyProgressHTML() : getUnhealthyProgressHTML()}
                    </div>
                </div>

                <div class="metric-card">
                    <h3>Health Checklist</h3>
                    <div class="checklist">
                        ${isHealthy ? getHealthyChecklistHTML() : getUnhealthyChecklistHTML()}
                    </div>
                </div>
            </div>

            <div class="highlight">
                <h3 style="color: #6f42c1; margin-bottom: 15px;">📊 Health Progress Visualization</h3>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${isHealthy ? '85' : '35'}%;"></div>
                </div>
                <p style="text-align: center; margin-top: 10px; font-weight: 600;">
                    ${isHealthy ? 'Excellent Health Status - Keep it up!' : 'Room for Improvement - Stay motivated!'}
                </p>
            </div>
        </div>

    </div>
</body>
</html>
    `.trim();
}

function getHealthyRecommendations() {
    return `
✓ Continue maintaining your healthy lifestyle
✓ Regular exercise (30 minutes daily)
✓ Balanced diet with fruits and vegetables
✓ Annual health checkups
✓ Monitor blood pressure and cholesterol
✓ Get adequate sleep (7-8 hours)
✓ Manage stress effectively
✓ Avoid smoking and excessive alcohol
    `.trim();
}

function getUnhealthyRecommendations() {
    return `
⚠️ Schedule immediate consultation with cardiologist
⚠️ Start heart-healthy diet immediately
⚠️ Begin supervised exercise program
⚠️ Monitor blood pressure daily
⚠️ Take prescribed medications as directed
⚠️ Quit smoking if applicable
⚠️ Reduce alcohol consumption
⚠️ Emergency plan for chest pain symptoms
    `.trim();
}

function getHealthyDetailedGuidance() {
    return `
NUTRITION GUIDANCE:
- Eat 5-7 servings of fruits and vegetables daily
- Choose whole grains over refined grains
- Include lean proteins (fish, poultry, beans)
- Limit saturated fats and trans fats
- Reduce sodium intake to <2,300mg daily

EXERCISE RECOMMENDATIONS:
- 150 minutes moderate aerobic activity weekly
- 75 minutes vigorous activity weekly
- Strength training 2-3 times per week
- Include flexibility and balance exercises

STRESS MANAGEMENT:
- Practice meditation or deep breathing
- Maintain work-life balance
- Get adequate sleep
- Engage in hobbies and social activities
    `.trim();
}

function getUnhealthyDetailedGuidance() {
    return `
IMMEDIATE ACTIONS REQUIRED:
- Contact your doctor within 24-48 hours
- If experiencing chest pain, call emergency services
- Start heart-healthy diet immediately
- Begin light exercise only with doctor approval

DIETARY CHANGES:
- Reduce sodium to <1,500mg daily
- Increase fiber intake (25-35g daily)
- Limit saturated fat to <7% of calories
- Avoid processed foods and sugary drinks
- Increase omega-3 fatty acids

MEDICATION COMPLIANCE:
- Take all prescribed medications as directed
- Never stop medications without doctor approval
- Keep a medication schedule
- Report any side effects immediately

SYMPTOM MONITORING:
- Track chest pain, shortness of breath, fatigue
- Monitor blood pressure and heart rate
- Keep a symptom diary
- Know when to seek emergency care
    `.trim();
}

function getHealthyFollowUp() {
    return `
- Annual physical examination
- Blood pressure check every 6 months
- Cholesterol test annually
- Continue current healthy lifestyle
- Regular dental checkups (gum health affects heart)
- Eye exams (diabetes screening)
    `.trim();
}

function getUnhealthyFollowUp() {
    return `
- Cardiologist appointment within 1 week
- Follow-up every 3-6 months
- Blood pressure monitoring weekly
- Cholesterol test in 3 months
- Stress test as recommended
- Medication review monthly
- Emergency plan in place
    `.trim();
}

function getHealthyMetrics() {
    return `
Target Blood Pressure: <120/80 mmHg
Target Cholesterol: <200 mg/dL
Target BMI: 18.5-24.9
Target Waist Circumference: <35" (women), <40" (men)
Target Exercise: 150 min/week moderate activity
Target Sleep: 7-8 hours nightly
    `.trim();
}

function getUnhealthyMetrics() {
    return `
Current Priority: Blood Pressure <140/90 mmHg
Target Cholesterol: <200 mg/dL (or as prescribed)
Weight Management: Gradual 5-10% weight loss
Exercise: Start with 10-15 min daily, increase gradually
Blood Sugar: Monitor if diabetic
Medication Adherence: 100% compliance
    `.trim();
}

function getHealthyGoals() {
    return `
- Maintain current healthy lifestyle
- Continue regular exercise routine
- Keep up balanced nutrition
- Annual health screenings
- Stress management techniques
- Regular sleep schedule
    `.trim();
}

function getUnhealthyGoals() {
    return `
- Lower blood pressure to target range
- Reduce cholesterol levels
- Achieve healthy weight
- Increase physical activity gradually
- Improve diet quality
- Quit smoking (if applicable)
- Manage stress effectively
    `.trim();
}

function getHealthyProgress() {
    return `
Monthly Tracking:
□ Blood pressure check
□ Weight monitoring
□ Exercise log review
□ Sleep quality assessment
□ Stress level evaluation
□ Nutrition review
    `.trim();
}

function getUnhealthyProgress() {
    return `
Weekly Tracking:
□ Blood pressure readings
□ Weight measurement
□ Medication compliance
□ Exercise minutes
□ Symptom monitoring
□ Doctor appointment scheduling
    `.trim();
}

function getHealthyChecklist() {
    return `
□ 30 minutes of exercise
□ 5+ servings fruits/vegetables
□ Adequate water intake
□ 7-8 hours sleep
□ Stress management practice
□ Regular meal times
□ Social connection
□ Hobby time
    `.trim();
}

function getUnhealthyChecklist() {
    return `
□ Take all prescribed medications
□ Monitor blood pressure
□ Follow heart-healthy diet
□ Light exercise (as approved)
□ Track symptoms
□ Avoid smoking/alcohol
□ Manage stress
□ Contact doctor if needed
    `.trim();
}

function showDownloadSuccess(format) {
    const formatNames = {
        'pdf': 'PDF Health Report',
        'txt': 'Text Summary',
        'dashboard': 'Health Dashboard'
    };
    
    // Create success notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        font-weight: 600;
        animation: slideInRight 0.3s ease-out;
    `;
    
    notification.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        ${formatNames[format]} downloaded successfully!
    `;
    
    document.body.appendChild(notification);
    
    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-in';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Add CSS for animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// HTML Helper Functions
function getHealthyRecommendationsHTML() {
    return `
        <li>Continue maintaining your healthy lifestyle</li>
        <li>Regular exercise (30 minutes daily)</li>
        <li>Balanced diet with fruits and vegetables</li>
        <li>Annual health checkups</li>
        <li>Monitor blood pressure and cholesterol</li>
        <li>Get adequate sleep (7-8 hours)</li>
        <li>Manage stress effectively</li>
        <li>Avoid smoking and excessive alcohol</li>
    `.trim();
}

function getUnhealthyRecommendationsHTML() {
    return `
        <li>Schedule immediate consultation with cardiologist</li>
        <li>Start heart-healthy diet immediately</li>
        <li>Begin supervised exercise program</li>
        <li>Monitor blood pressure daily</li>
        <li>Take prescribed medications as directed</li>
        <li>Quit smoking if applicable</li>
        <li>Reduce alcohol consumption</li>
        <li>Emergency plan for chest pain symptoms</li>
    `.trim();
}

function getHealthyDetailedGuidanceHTML() {
    return `
        <h4>🥗 NUTRITION GUIDANCE:</h4>
        <p>• Eat 5-7 servings of fruits and vegetables daily</p>
        <p>• Choose whole grains over refined grains</p>
        <p>• Include lean proteins (fish, poultry, beans)</p>
        <p>• Limit saturated fats and trans fats</p>
        <p>• Reduce sodium intake to <2,300mg daily</p>
        
        <h4>🏃 EXERCISE RECOMMENDATIONS:</h4>
        <p>• 150 minutes moderate aerobic activity weekly</p>
        <p>• 75 minutes vigorous activity weekly</p>
        <p>• Strength training 2-3 times per week</p>
        <p>• Include flexibility and balance exercises</p>
        
        <h4>🧘 STRESS MANAGEMENT:</h4>
        <p>• Practice meditation or deep breathing</p>
        <p>• Maintain work-life balance</p>
        <p>• Get adequate sleep</p>
        <p>• Engage in hobbies and social activities</p>
    `.trim();
}

function getUnhealthyDetailedGuidanceHTML() {
    return `
        <h4>🚨 IMMEDIATE ACTIONS REQUIRED:</h4>
        <p>• Contact your doctor within 24-48 hours</p>
        <p>• If experiencing chest pain, call emergency services</p>
        <p>• Start heart-healthy diet immediately</p>
        <p>• Begin light exercise only with doctor approval</p>
        
        <h4>🥗 DIETARY CHANGES:</h4>
        <p>• Reduce sodium to <1,500mg daily</p>
        <p>• Increase fiber intake (25-35g daily)</p>
        <p>• Limit saturated fat to <7% of calories</p>
        <p>• Avoid processed foods and sugary drinks</p>
        <p>• Increase omega-3 fatty acids</p>
        
        <h4>💊 MEDICATION COMPLIANCE:</h4>
        <p>• Take all prescribed medications as directed</p>
        <p>• Never stop medications without doctor approval</p>
        <p>• Keep a medication schedule</p>
        <p>• Report any side effects immediately</p>
    `.trim();
}

function getHealthyMetricsHTML() {
    return `
        <p><strong>Target Blood Pressure:</strong> <120/80 mmHg</p>
        <p><strong>Target Cholesterol:</strong> <200 mg/dL</p>
        <p><strong>Target BMI:</strong> 18.5-24.9</p>
        <p><strong>Target Waist Circumference:</strong> <35" (women), <40" (men)</p>
        <p><strong>Target Exercise:</strong> 150 min/week moderate activity</p>
        <p><strong>Target Sleep:</strong> 7-8 hours nightly</p>
    `.trim();
}

function getUnhealthyMetricsHTML() {
    return `
        <p><strong>Current Priority:</strong> Blood Pressure <140/90 mmHg</p>
        <p><strong>Target Cholesterol:</strong> <200 mg/dL (or as prescribed)</p>
        <p><strong>Weight Management:</strong> Gradual 5-10% weight loss</p>
        <p><strong>Exercise:</strong> Start with 10-15 min daily, increase gradually</p>
        <p><strong>Blood Sugar:</strong> Monitor if diabetic</p>
        <p><strong>Medication Adherence:</strong> 100% compliance</p>
    `.trim();
}

function getHealthyGoalsHTML() {
    return `
        <p>• Maintain current healthy lifestyle</p>
        <p>• Continue regular exercise routine</p>
        <p>• Keep up balanced nutrition</p>
        <p>• Annual health screenings</p>
        <p>• Stress management techniques</p>
        <p>• Regular sleep schedule</p>
    `.trim();
}

function getUnhealthyGoalsHTML() {
    return `
        <p>• Lower blood pressure to target range</p>
        <p>• Reduce cholesterol levels</p>
        <p>• Achieve healthy weight</p>
        <p>• Increase physical activity gradually</p>
        <p>• Improve diet quality</p>
        <p>• Quit smoking (if applicable)</p>
        <p>• Manage stress effectively</p>
    `.trim();
}

function getHealthyProgressHTML() {
    return `
        <h4>📅 Monthly Tracking:</h4>
        <p>• Blood pressure check</p>
        <p>• Weight monitoring</p>
        <p>• Exercise log review</p>
        <p>• Sleep quality assessment</p>
        <p>• Stress level evaluation</p>
        <p>• Nutrition review</p>
    `.trim();
}

function getUnhealthyProgressHTML() {
    return `
        <h4>📅 Weekly Tracking:</h4>
        <p>• Blood pressure readings</p>
        <p>• Weight measurement</p>
        <p>• Medication compliance</p>
        <p>• Exercise minutes</p>
        <p>• Symptom monitoring</p>
        <p>• Doctor appointment scheduling</p>
    `.trim();
}

function getHealthyChecklistHTML() {
    return `
        <div class="checklist-item">30 minutes of exercise</div>
        <div class="checklist-item">5+ servings fruits/vegetables</div>
        <div class="checklist-item">Adequate water intake</div>
        <div class="checklist-item">7-8 hours sleep</div>
        <div class="checklist-item">Stress management practice</div>
        <div class="checklist-item">Regular meal times</div>
        <div class="checklist-item">Social connection</div>
        <div class="checklist-item">Hobby time</div>
    `.trim();
}

function getUnhealthyChecklistHTML() {
    return `
        <div class="checklist-item">Take all prescribed medications</div>
        <div class="checklist-item">Monitor blood pressure</div>
        <div class="checklist-item">Follow heart-healthy diet</div>
        <div class="checklist-item">Light exercise (as approved)</div>
        <div class="checklist-item">Track symptoms</div>
        <div class="checklist-item">Avoid smoking/alcohol</div>
        <div class="checklist-item">Manage stress</div>
        <div class="checklist-item">Contact doctor if needed</div>
    `.trim();
}
</script>
{% endblock %}
